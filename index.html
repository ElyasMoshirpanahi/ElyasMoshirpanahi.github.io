<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elyas Moshirpanahi | Senior GenAI Engineer</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&family=Audiowide&family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- VARIABLES --- */
        :root {
            --neon-cyan: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-purple: #bc13fe;
            --neon-blue: #0055ff;
            --bg-dark: #050510;
            --font-display: 'Orbitron', sans-serif;
            --font-tech: 'Rajdhani', sans-serif;
            --font-retro: 'Audiowide', cursive;
        }

        /* --- RESET --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--bg-dark); 
            color: white; 
            font-family: var(--font-tech); 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        /* --- LAYERS --- */
        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none; /* Pass clicks to canvas if needed, but mainly buttons */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* --- SCREEN EFFECTS --- */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.15) 50%, rgba(0,0,0,0.15));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 90;
            opacity: 0.6;
        }
        
        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 50%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
            z-index: 80;
        }
        
        /* --- LOADER --- */
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }
        
        .loader-title {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--neon-cyan);
            margin-bottom: 2rem;
            text-shadow: 0 0 20px var(--neon-cyan);
            letter-spacing: 4px;
        }

        .start-btn {
            background: transparent;
            border: 2px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 1.5rem 4rem;
            font-family: var(--font-display);
            font-weight: 900;
            font-size: 1.5rem;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 0 15px var(--neon-pink), inset 0 0 10px var(--neon-pink);
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .start-btn:hover {
            background: var(--neon-pink);
            color: #000;
            box-shadow: 0 0 50px var(--neon-pink);
            transform: scale(1.05);
        }

        /* --- HEADER & CONTROLS --- */
        .top-bar {
            pointer-events: auto;
            display: flex;
            justify-content: flex-end;
            padding: 2rem;
            gap: 1.5rem;
        }

        .toggle-btn {
            background: rgba(0,0,0,0.6);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 0.5rem 1.2rem;
            font-family: var(--font-display);
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: blur(5px);
            transition: 0.3s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .toggle-btn:hover, .toggle-btn.active {
            background: rgba(0, 243, 255, 0.2);
            box-shadow: 0 0 15px var(--neon-cyan);
            text-shadow: 0 0 5px var(--neon-cyan);
        }

        /* --- HERO TEXT --- */
        .hero-section {
            pointer-events: none;
            text-align: center;
            margin-top: 5vh;
            position: relative;
            z-index: 50;
        }

        h1 {
            font-family: var(--font-display);
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1.1;
            margin-bottom: 0.5rem;
            color: #fff;
            text-shadow: 
                2px 2px 0px var(--neon-purple),
                -2px -2px 0px var(--neon-cyan),
                0 0 30px rgba(0, 243, 255, 0.5);
            animation: glitch 3s infinite alternate;
        }

        h2 {
            font-family: var(--font-retro);
            font-size: 1.2rem;
            color: var(--neon-pink);
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px var(--neon-pink);
            background: rgba(0,0,0,0.5);
            display: inline-block;
            padding: 0.5rem 2rem;
            border: 1px solid rgba(255,0,255,0.3);
            border-radius: 4px;
            backdrop-filter: blur(4px);
        }

        @keyframes glitch {
            0% { transform: skew(0deg); }
            20% { transform: skew(-1deg); }
            40% { transform: skew(1deg); }
            60% { transform: skew(0deg); }
            80% { transform: skew(-0.5deg); }
            100% { transform: skew(0.5deg); }
        }

        /* --- ACTION BUTTONS --- */
        .nav-grid {
            pointer-events: auto;
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
        }

        .nav-btn {
            position: relative;
            padding: 1rem 2.5rem;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            color: white;
            background: rgba(0,0,0,0.7);
            border: 2px solid;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            backdrop-filter: blur(10px);
        }

        .btn-cyan { border-color: var(--neon-cyan); color: var(--neon-cyan); }
        .btn-pink { border-color: var(--neon-pink); color: var(--neon-pink); }
        .btn-purple { border-color: var(--neon-purple); color: var(--neon-purple); }

        .nav-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 20px currentColor;
            text-shadow: 0 0 8px currentColor;
        }

        .nav-btn:active { transform: scale(0.98); }

        /* --- SOCIAL FOOTER --- */
        .social-bar {
            pointer-events: auto;
            padding: 2rem;
            display: flex;
            justify-content: center;
            gap: 3rem;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }

        .social-icon {
            font-size: 1.8rem;
            color: rgba(255,255,255,0.5);
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
        }
        
        .social-icon:hover { transform: scale(1.2) translateY(-5px); color: white; }
        
        .soc-li:hover { color: #0077b5; text-shadow: 0 0 20px #0077b5; }
        .soc-gh:hover { color: #ffffff; text-shadow: 0 0 20px #ffffff; }
        .soc-em:hover { color: var(--neon-purple); text-shadow: 0 0 20px var(--neon-purple); }
        .soc-ig:hover { color: #E1306C; text-shadow: 0 0 20px #E1306C; }
        .soc-tg:hover { color: #0088cc; text-shadow: 0 0 20px #0088cc; }

    </style>
</head>
<body>

    <!-- AUDIO SYSTEM -->
    <audio id="bg-music" loop>
        <source src="music/RETRO1.m4a" type="audio/mp4">
    </audio>
    <audio id="sfx-hover">
        <source src="sounds/pulse_sound_try1-89547.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-beam">
        <source src="sounds/science-fiction-effect-011-305473.mp3" type="audio/mpeg">
    </audio>

    <!-- LOADING SCREEN -->
    <div id="loader">
        <div class="loader-title">SYSTEM BOOT SEQUENCE</div>
        <button class="start-btn" id="start-btn">INITIALIZE</button>
    </div>

    <!-- OVERLAYS -->
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <!-- CANVAS -->
    <div id="canvas-container"></div>

    <!-- UI LAYER -->
    <div id="ui-layer">
        
        <!-- CONTROLS -->
        <div class="top-bar">
            <button class="toggle-btn active" id="btn-music"><i class="fas fa-music"></i> MUSIC: ON</button>
            <button class="toggle-btn active" id="btn-sfx"><i class="fas fa-volume-up"></i> SFX: ON</button>
        </div>

        <!-- HERO CONTENT -->
        <div class="hero-section">
            <h1>Elyas Moshirpanahi</h1>
            <h2>Senior Generative AI Engineer</h2>
            
            <div class="nav-grid">
                <a href="#" class="nav-btn btn-cyan" onmouseenter="playHover()">Portfolio</a>
                <a href="#" class="nav-btn btn-pink" onmouseenter="playHover()">Resume</a>
                <a href="#" class="nav-btn btn-purple" onmouseenter="playHover()">Terminal</a>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="social-bar">
            <a href="https://linkedin.com" target="_blank" class="social-icon soc-li" onmouseenter="playHover()"><i class="fab fa-linkedin"></i></a>
            <a href="https://github.com" target="_blank" class="social-icon soc-gh" onmouseenter="playHover()"><i class="fab fa-github"></i></a>
            <a href="mailto:elyas@example.com" class="social-icon soc-em" onmouseenter="playHover()"><i class="fas fa-envelope"></i></a>
            <a href="https://instagram.com" target="_blank" class="social-icon soc-ig" onmouseenter="playHover()"><i class="fab fa-instagram"></i></a>
            <a href="https://telegram.org" target="_blank" class="social-icon soc-tg" onmouseenter="playHover()"><i class="fab fa-telegram"></i></a>
        </div>
    </div>

    <!-- THREE.JS IMPORTS -->
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <!-- LOGIC -->
    <script>
        // --- CONFIGURATION ---
        const CONF = {
            fov: 60,
            speed: 40, // Much faster for Cyberpunk feel
            colors: {
                cyan: 0x00f3ff,
                pink: 0xff00ff,
                purple: 0xbc13fe,
                blue: 0x0055ff,
                grid: 0x220033
            }
        };

        // --- AUDIO STATE ---
        let musicEnabled = true;
        let sfxEnabled = true;
        const bgMusic = document.getElementById('bg-music');
        const sfxHover = document.getElementById('sfx-hover');
        const sfxBeam = document.getElementById('sfx-beam');

        // --- SCENE GLOBALS ---
        let scene, camera, renderer, composer;
        let road, car;
        let cityGroup, sunMesh, beamMesh;
        let palms = [], arches = [];
        const clock = new THREE.Clock();
        let time = 0;

        // --- INIT ---
        window.onload = () => {
            const btn = document.getElementById('start-btn');
            btn.addEventListener('click', () => {
                document.getElementById('loader').style.opacity = 0;
                setTimeout(() => document.getElementById('loader').remove(), 1000);
                if(musicEnabled) {
                    bgMusic.volume = 0.4;
                    bgMusic.play().catch(console.error);
                }
                initThree();
            });
        };

        function initThree() {
            const container = document.getElementById('canvas-container');

            // 1. Scene & Camera
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050510, 0.005); // Thick cyber fog
            scene.background = new THREE.Color(0x050510);

            camera = new THREE.PerspectiveCamera(CONF.fov, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3.5, 12);
            camera.lookAt(0, 1, -50);

            // 2. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.toneMapping = THREE.ReinhardToneMapping;
            container.appendChild(renderer.domElement);

            // 3. Post Processing (BLOOM IS KEY)
            const renderPass = new THREE.RenderPass(scene, camera);
            const bloomPass = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight), 
                1.5, 0.4, 0.85
            );
            bloomPass.threshold = 0;
            bloomPass.strength = 1.6; // High bloom for neon
            bloomPass.radius = 0.4;

            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderPass);
            composer.addPass(bloomPass);

            // 4. Build World
            createLights();
            createSun();
            createCity();
            createRoad();
            createCar();
            createTronStation();
            
            // Populate Palms & Arches
            for(let i=0; i<20; i++) spawnPalm(-i*15);
            for(let i=0; i<10; i++) spawnArch(-i*30 - 10);

            // 5. Events
            window.addEventListener('resize', onResize);
            
            // 6. Loop
            animate();
        }

        function createLights() {
            const ambient = new THREE.AmbientLight(0xffffff, 0.1);
            scene.add(ambient);
            
            const p1 = new THREE.PointLight(CONF.colors.pink, 1.5, 60);
            p1.position.set(-10, 5, 0);
            scene.add(p1);

            const p2 = new THREE.PointLight(CONF.colors.cyan, 1.5, 60);
            p2.position.set(10, 5, 0);
            scene.add(p2);
        }

        // --- OBJECTS ---

        function createSun() {
            // Retro Sun Shader
            const geometry = new THREE.CircleGeometry(50, 64);
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    color1: { value: new THREE.Color(0xff00cc) }, // Magenta
                    color2: { value: new THREE.Color(0xffaa00) }, // Yellow/Orange
                    uTime: { value: 0 }
                },
                vertexShader: `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec2 vUv;
                    uniform vec3 color1;
                    uniform vec3 color2;
                    uniform float uTime;
                    void main() {
                        vec3 grad = mix(color2, color1, vUv.y);
                        // Stripes
                        float stripe = fract((vUv.y - uTime * 0.05) * 20.0);
                        float gap = step(0.2, stripe); // 0.2 is gap size
                        if(vUv.y < 0.6) {
                            if(gap < 0.5) discard;
                        }
                        gl_FragColor = vec4(grad, 1.0);
                    }
                `,
                transparent: true
            });
            sunMesh = new THREE.Mesh(geometry, material);
            sunMesh.position.set(0, 20, -200);
            scene.add(sunMesh);
        }

        function createCity() {
            // Cyberpunk Skyline
            cityGroup = new THREE.Group();
            
            const boxGeo = new THREE.BoxGeometry(1, 1, 1);
            const boxMat = new THREE.MeshBasicMaterial({ color: 0x000000 }); // Silhouette mostly
            const neonMat = new THREE.MeshBasicMaterial({ color: CONF.colors.cyan });
            const winMat = new THREE.MeshBasicMaterial({ color: CONF.colors.pink });

            // Create 100 buildings
            for(let i=0; i<100; i++) {
                const h = 20 + Math.random() * 60;
                const w = 5 + Math.random() * 10;
                const d = 5 + Math.random() * 10;
                const x = (Math.random() - 0.5) * 400;
                const z = -200 - Math.random() * 100;

                const b = new THREE.Mesh(boxGeo, boxMat);
                b.position.set(x, h/2, z);
                b.scale.set(w, h, d);
                cityGroup.add(b);

                // Add random neon strips
                if(Math.random() > 0.5) {
                    const strip = new THREE.Mesh(boxGeo, neonMat);
                    strip.position.set(x, h * Math.random(), z + d/2 + 0.1);
                    strip.scale.set(w * 0.8, 0.5, 0.1);
                    cityGroup.add(strip);
                }
                
                // Add window lights
                if(Math.random() > 0.3) {
                    const win = new THREE.Mesh(boxGeo, winMat);
                    win.position.set(x + (Math.random()-0.5)*w, h * Math.random(), z + d/2 + 0.15);
                    win.scale.set(1, 1, 0.1);
                    cityGroup.add(win);
                }
            }
            scene.add(cityGroup);
        }

        function createRoad() {
            // 1. Grid Road
            const geometry = new THREE.PlaneGeometry(80, 400, 40, 100);
            geometry.rotateX(-Math.PI / 2);

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    uColor: { value: new THREE.Color(CONF.colors.purple) },
                    uTime: { value: 0 }
                },
                vertexShader: `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec2 vUv;
                    uniform vec3 uColor;
                    uniform float uTime;
                    void main() {
                        // Moving grid
                        float y = fract(vUv.y * 40.0 + uTime * 8.0);
                        float lineY = step(0.85, y); // Horizontal lines
                        
                        float lineX = step(0.97, fract(vUv.x * 20.0)); // Vertical lines
                        
                        float glow = max(lineY, lineX);
                        
                        // Fade edges
                        float alpha = (1.0 - abs(vUv.x - 0.5) * 2.0);
                        alpha = pow(alpha, 2.0);

                        gl_FragColor = vec4(uColor, glow * alpha);
                    }
                `,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            road = new THREE.Mesh(geometry, material);
            road.position.z = -100;
            scene.add(road);

            // 2. Wet Asphalt Reflector
            const reflectGeo = new THREE.PlaneGeometry(80, 400);
            reflectGeo.rotateX(-Math.PI/2);
            const reflectMat = new THREE.MeshStandardMaterial({
                color: 0x000000,
                roughness: 0.1,
                metalness: 0.8
            });
            const reflector = new THREE.Mesh(reflectGeo, reflectMat);
            reflector.position.set(0, -0.1, -100);
            scene.add(reflector);
        }

        function createCar() {
            const carGrp = new THREE.Group();
            
            // Refined DeLorean Shape
            const mBody = new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.9, roughness: 0.2 });
            const mBlack = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const mGlowC = new THREE.MeshBasicMaterial({ color: CONF.colors.cyan });
            const mGlowP = new THREE.MeshBasicMaterial({ color: CONF.colors.pink });

            // Main Body (Wedge)
            const chassis = new THREE.Mesh(new THREE.BoxGeometry(2.4, 0.5, 5), mBody);
            chassis.position.y = 0.5;
            carGrp.add(chassis);

            // Roof
            const roof = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.45, 2.5), mBlack);
            roof.position.set(0, 0.95, -0.2);
            carGrp.add(roof);
            
            // Louvers (Rear window slats)
            for(let i=0; i<6; i++) {
                const slat = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.05, 0.2), mBody);
                slat.position.set(0, 1.0 - i*0.05, 1.2 + i*0.2);
                slat.rotation.x = -0.2;
                carGrp.add(slat);
            }

            // Wheels
            const wGeo = new THREE.CylinderGeometry(0.4, 0.4, 0.35, 24);
            wGeo.rotateZ(Math.PI/2);
            [[-1.2, 1.6], [1.2, 1.6], [-1.2, -1.6], [1.2, -1.6]].forEach(pos => {
                const w = new THREE.Mesh(wGeo, mBlack);
                w.position.set(pos[0], 0.4, pos[1]);
                carGrp.add(w);
                // Hubcap glow
                const h = new THREE.Mesh(new THREE.CircleGeometry(0.25, 16), mGlowC);
                h.rotation.y = pos[0] > 0 ? Math.PI/2 : -Math.PI/2;
                h.position.set(pos[0] > 0 ? pos[0]+0.18 : pos[0]-0.18, 0.4, pos[1]);
                carGrp.add(h);
            });

            // Lights
            const tail = new THREE.Mesh(new THREE.BoxGeometry(2.2, 0.1, 0.1), mGlowP);
            tail.position.set(0, 0.65, 2.5);
            carGrp.add(tail);

            const head = new THREE.Mesh(new THREE.BoxGeometry(2.2, 0.08, 0.1), mGlowC);
            head.position.set(0, 0.5, -2.5);
            carGrp.add(head);

            // Underglow
            const ug = new THREE.Mesh(new THREE.PlaneGeometry(2.2, 4.8), new THREE.MeshBasicMaterial({ color: CONF.colors.cyan, side: THREE.DoubleSide }));
            ug.rotation.x = -Math.PI/2;
            ug.position.y = 0.1;
            carGrp.add(ug);

            car = carGrp;
            scene.add(car);
        }

        function createTronStation() {
            const station = new THREE.Group();
            
            // Base Ring
            const ring = new THREE.Mesh(
                new THREE.TorusGeometry(15, 0.5, 16, 64),
                new THREE.MeshBasicMaterial({ color: CONF.colors.cyan })
            );
            ring.rotation.x = Math.PI/2;
            station.add(ring);

            // Pylons
            const pylonGeo = new THREE.BoxGeometry(2, 40, 2);
            const pMat = new THREE.MeshBasicMaterial({ color: 0x111111 });
            const p1 = new THREE.Mesh(pylonGeo, pMat); p1.position.x = -15;
            const p2 = new THREE.Mesh(pylonGeo, pMat); p2.position.x = 15;
            station.add(p1); station.add(p2);

            // Beam Mesh (Hidden default)
            beamMesh = new THREE.Mesh(
                new THREE.CylinderGeometry(1, 1, 300, 16),
                new THREE.MeshBasicMaterial({ color: 0x88ffff, transparent: true, opacity: 0.8 })
            );
            beamMesh.position.y = 150;
            beamMesh.visible = false;
            station.add(beamMesh);

            station.position.set(0, 0, -150);
            scene.add(station);
        }

        // --- PROCEDURAL SPAWNERS ---
        function spawnPalm(z) {
            const grp = new THREE.Group();
            // Trunk
            const t = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.5, 8, 7),
                new THREE.MeshBasicMaterial({ color: CONF.colors.pink })
            );
            t.position.y = 4;
            grp.add(t);
            // Leaves (Fuller)
            const lMat = new THREE.MeshBasicMaterial({ color: CONF.colors.cyan, side: THREE.DoubleSide });
            const lGeo = new THREE.PlaneGeometry(2, 6);
            for(let i=0; i<8; i++) {
                const l = new THREE.Mesh(lGeo, lMat);
                l.position.y = 8;
                l.rotation.y = (i/8) * Math.PI * 2;
                l.rotation.z = Math.PI/3; // Arch down
                grp.add(l);
            }
            
            // Left & Right
            const left = grp.clone(); left.position.set(-25, 0, z);
            const right = grp.clone(); right.position.set(25, 0, z);
            
            scene.add(left); palms.push(left);
            scene.add(right); palms.push(right);
        }

        function spawnArch(z) {
            const arch = new THREE.Mesh(
                new THREE.TorusGeometry(20, 0.3, 8, 32, Math.PI),
                new THREE.MeshBasicMaterial({ color: CONF.colors.purple })
            );
            arch.position.set(0, 0, z);
            scene.add(arch);
            arches.push(arch);
        }

        // --- ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            const dt = clock.getDelta();
            time += dt;

            // 1. Uniforms
            if(road) road.material.uniforms.uTime.value = time;
            if(sunMesh) sunMesh.material.uniforms.uTime.value = time;

            // 2. Scroll World
            const move = CONF.speed * dt;
            
            palms.forEach(p => {
                p.position.z += move;
                if(p.position.z > 20) p.position.z = -280;
            });
            arches.forEach(a => {
                a.position.z += move;
                if(a.position.z > 20) a.position.z = -280;
            });

            // 3. Car Shake
            if(car) {
                car.position.y = 0.5 + Math.sin(time * 30) * 0.01;
                car.rotation.z = Math.sin(time * 5) * 0.01;
            }

            // 4. TRON Beam Event (Every 30s)
            const cycle = time % 30;
            if(cycle > 28) {
                if(!beamMesh.visible) {
                    beamMesh.visible = true;
                    if(sfxEnabled) {
                        sfxBeam.currentTime = 0; 
                        sfxBeam.volume = 0.6;
                        sfxBeam.play().catch(()=>{});
                    }
                }
                const s = Math.sin((cycle-28)*Math.PI) * 4 + 1;
                beamMesh.scale.set(s, 1, s);
            } else {
                beamMesh.visible = false;
            }

            composer.render();
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- UI INTERACTION ---
        window.playHover = () => {
            if(sfxEnabled) {
                sfxHover.currentTime = 0;
                sfxHover.volume = 0.2;
                sfxHover.play().catch(()=>{});
            }
        };

        // Toggles
        document.getElementById('btn-music').addEventListener('click', function() {
            musicEnabled = !musicEnabled;
            this.classList.toggle('active');
            this.innerHTML = musicEnabled ? '<i class="fas fa-music"></i> MUSIC: ON' : '<i class="fas fa-music"></i> MUSIC: OFF';
            if(musicEnabled) bgMusic.play(); else bgMusic.pause();
        });

        document.getElementById('btn-sfx').addEventListener('click', function() {
            sfxEnabled = !sfxEnabled;
            this.classList.toggle('active');
            this.innerHTML = sfxEnabled ? '<i class="fas fa-volume-up"></i> SFX: ON' : '<i class="fas fa-volume-up"></i> SFX: OFF';
        });

    </script>
</body>
</html>